<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BPC Intro â€¢ MP4</title>
<style>
  :root{--bg:#000;--fg:#eaeaea}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,Segoe UI,Arial,sans-serif;display:grid;grid-template-rows:auto 1fr auto;min-height:100svh}
  header,footer{padding:12px 16px;opacity:.9}
  header b{letter-spacing:.03em}
  .panel{display:flex;gap:10px;flex-wrap:wrap;align-items:center;padding:0 16px 10px}
  input,button{background:#101010;color:var(--fg);border:1px solid #2a2a2a;border-radius:10px;padding:9px 12px}
  button{cursor:pointer}
  button:hover{border-color:#5a5a5a}
  #cv{width:100%;max-width:1080px;aspect-ratio:16/9;display:block;margin:0 auto;border-radius:14px;background:#000}
  .pill{border-radius:999px;padding:6px 10px;border:1px solid #2a2a2a;font-size:12px}
  #dl{display:none}
</style>
</head>
<body>
<header><b>ðŸ¦š BPC Marka Intro â€¢ MP4</b></header>

<div class="panel">
  <label>SÃ¼re(sn) <input id="dur" type="number" value="6" min="4" max="10"></label>
  <label>Ã‡Ã¶zÃ¼nÃ¼rlÃ¼k <input id="res" type="number" value="1920"></label>
  <button id="preview">Ã–nizleme</button>
  <button id="record">KaydÄ± Al (MP4)</button>
  <a id="dl" class="pill" download="bpc-intro.mp4">Ä°ndir</a>
  <span id="status" class="pill">1080p/60fps Ã¶nerilir</span>
</div>

<canvas id="cv" width="1920" height="1080"></canvas>

<footer>AkÄ±ÅŸ: 0â€“1s fade-in â€¢ 1â€“4s hafif nefes/pulse â€¢ 4â€“5s parlama Ã§izgisi â€¢ 5â€“6s fade-out.</footer>

<script>
(() => {
  const cv=document.getElementById('cv'), cx=cv.getContext('2d');
  const ui={
    dur:document.getElementById('dur'),
    res:document.getElementById('res'),
    preview:document.getElementById('preview'),
    record:document.getElementById('record'),
    dl:document.getElementById('dl'),
    status:document.getElementById('status'),
  };
  const FPS=60, AR=16/9;
  let raf=0, t0=0, playing=false;

  function setSize(w){
    const W=Math.max(960,Math.min(3840,parseInt(w||1920,10)));
    cv.width=W; cv.height=Math.round(W/AR);
  }

  // KuÅŸ gÃ¶rseli (siyah arka planÄ± transparan yap)
  const raw=new Image(); raw.crossOrigin='anonymous'; raw.src='bpc-bird.png';
  let logo=null; raw.onload=()=>{ const off=document.createElement('canvas'), o=off.getContext('2d');
    off.width=raw.naturalWidth; off.height=raw.naturalHeight; o.drawImage(raw,0,0);
    const img=o.getImageData(0,0,off.width,off.height), d=img.data;
    for(let i=0;i<d.length;i+=4){ const r=d[i],g=d[i+1],b=d[i+2]; if(r<20&&g<20&&b<20) d[i+3]=0; }
    o.putImageData(img,0,0); logo=off;
  };

  // Easingler
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  const easeOutCubic=t=>1-Math.pow(1-t,3);
  const easeInCubic=t=>t*t*t;

  // ZamanlÄ± intro
  function draw(ts){
    const W=cv.width,H=cv.height; const now=((ts-t0)/1000)||0;
    cx.clearRect(0,0,W,H);

    // timeline
    const D = clamp(+ui.dur.value||6,4,10);
    const fadeIn = clamp(now/1.0,0,1);
    const hold   = clamp((now-1)/3,0,1);
    const shineT = clamp((now-4)/1,0,1);
    const fadeOut= clamp((now-(D-1))/1,0,1);

    // arka plan + vignette
    cx.fillStyle='#000'; cx.fillRect(0,0,W,H);
    const vign=cx.createRadialGradient(W/2,H/2,0,W/2,H/2,W*0.65);
    vign.addColorStop(0,'rgba(255,255,255,0.08)'); vign.addColorStop(1,'rgba(0,0,0,0)');
    cx.fillStyle=vign; cx.fillRect(0,0,W,H);

    // parlayan halka (minimal)
    cx.save(); cx.translate(W/2,H/2);
    cx.globalAlpha=0.35*fadeIn*(1-fadeOut);
    cx.lineWidth=W*0.02; cx.strokeStyle='#0ff';
    const ring=cx.createConicGradient(now*0.25,0,0); ring.addColorStop(0,'#00ffd5'); ring.addColorStop(1,'#7f00ff'); cx.strokeStyle=ring;
    cx.shadowBlur=W*0.02; cx.shadowColor='rgba(0,255,200,.4)';
    cx.beginPath(); cx.arc(0,0,H*0.25,0,Math.PI*2); cx.stroke(); cx.restore();

    // kuÅŸ
    if(logo){
      const base = H*0.42;
      const breath = 1 + Math.sin(now*1.6)*0.03*hold;
      const alpha = easeOutCubic(fadeIn)*(1-easeInCubic(fadeOut));
      cx.save();
      cx.globalAlpha=alpha;
      cx.translate(W/2,H*0.52);
      // shine Ã§izgisi (4â€“5s arasÄ±)
      if(shineT>0 && shineT<1){
        cx.save(); cx.rotate(-Math.PI/6);
        const x = (shineT*1.8 - 0.4)*base*2;
        const grd = cx.createLinearGradient(x-80,-base,x+80,base);
        grd.addColorStop(0,'rgba(255,255,255,0)'); grd.addColorStop(0.5,'rgba(255,255,255,.25)'); grd.addColorStop(1,'rgba(255,255,255,0)');
        cx.globalCompositeOperation='screen';
        cx.fillStyle=grd; cx.fillRect(-base,-base, base*2, base*2); cx.restore();
      }
      cx.shadowColor='rgba(0,255,200,.35)'; cx.shadowBlur=W*0.02;
      cx.scale(breath,breath);
      cx.drawImage(logo,-base/2,-base/2,base,base);
      cx.restore();
    }

    // metin (Ã§ok sade)
    cx.globalAlpha=(1-fadeOut)*fadeIn; cx.fillStyle='#eaeaea'; cx.textAlign='center';
    cx.font=Math.round(H*0.08)+'px system-ui,Segoe UI,Arial'; cx.fillText('BabyPeacock â€¢ BPC', W/2, H*0.2);

    if(now < D){ raf=requestAnimationFrame(draw); } else { playing=false; }
  }

  function startPreview(){
    cancelAnimationFrame(raf); setSize(ui.res.value); t0=performance.now(); playing=true; raf=requestAnimationFrame(draw);
    ui.status.textContent='Ã–nizleme oynuyor';
  }

  async function record(){
    cancelAnimationFrame(raf); setSize(ui.res.value);
    const secs = clamp(+ui.dur.value||6,4,10);
    const stream=cv.captureStream(FPS);
    let chunks=[]; const mime = (MediaRecorder.isTypeSupported?.('video/mp4;codecs=avc1.4d0028'))?'video/mp4;codecs=avc1.4d0028':'video/webm;codecs=vp9';
    const rec=new MediaRecorder(stream,{mimeType:mime,videoBitsPerSecond:10_000_000});
    rec.ondataavailable=e=>{ if(e.data&&e.data.size) chunks.push(e.data); };
    rec.onstop=()=>{ const blob=new Blob(chunks,{type:mime}); const url=URL.createObjectURL(blob);
      ui.dl.href=url; ui.dl.download = mime.startsWith('video/mp4')?'bpc-intro.mp4':'bpc-intro.webm';
      ui.dl.style.display='inline-block'; ui.dl.textContent='Ä°ndir: '+ui.dl.download; ui.status.textContent='KayÄ±t tamamlandÄ±.'; };
    // zamanlÄ± oynat + kayÄ±t
    t0=performance.now(); raf=requestAnimationFrame(draw); rec.start();
    ui.status.textContent='Kaydediliyor...';
    setTimeout(()=>{ if(rec.state!=='inactive') rec.stop(); cancelAnimationFrame(raf); }, secs*1000+120);
  }

  ui.preview.onclick=startPreview;
  ui.record.onclick=record;
})();
</script>
</body>
</html>
