<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Babypeacock — Top-Down Mars İnişi</title>
<style>
  :root{ --descent:6.7s; --shake:.7s; --dust:1.1s; }
  html,body{margin:0;height:100%;background:#000;color:#fff;font-family:system-ui;overflow:hidden}
  #bg{position:fixed; inset:0; display:block}
  .vignette::after{content:"";position:fixed;inset:0;pointer-events:none;
    background:radial-gradient(120% 80% at 50% 35%, rgba(0,0,0,0), rgba(0,0,0,.25))}

  /* Üst başlık (mavi-yeşil degrade) */
  .safe{position:fixed; left:12px; top:12px; z-index:20; display:flex; gap:10px; align-items:center}
  .brand{
    font-weight:800; font-size:20px; letter-spacing:.2px;
    background:linear-gradient(90deg,#22d3ee,#10b981);
    -webkit-background-clip:text; background-clip:text; color:transparent;
    text-shadow:0 1px 2px rgba(0,0,0,.35);
  }
  .btn{margin-left:8px; padding:.5rem .9rem; border-radius:999px;
       border:1px solid rgba(255,255,255,.22); background:rgba(0,0,0,.45); color:#fff}

  /* GEMİ: büyük başlar → küçülerek zemine iner + tilt */
  .lander{
    position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
    width:min(60vmin,520px); aspect-ratio:1/1; z-index:10; will-change:transform,filter,opacity;
    animation:
      descend var(--descent) cubic-bezier(.2,.85,.15,1) forwards,
      tilt var(--descent) ease-in-out forwards,
      idle 3s ease-in-out var(--descent) infinite alternate;
  }
  .ship{width:100%; height:100%; object-fit:contain; display:block;
        mix-blend-mode:screen; filter:brightness(1.22) contrast(1.06) drop-shadow(0 10px 18px rgba(0,0,0,.5))}
  .flame{
    position:absolute; left:50%; top:84%; transform:translate(-50%,-50%);
    width:36%; height:36%; z-index:-1; pointer-events:none; mix-blend-mode:screen;
    background:
      radial-gradient(45% 65% at 50% 60%, rgba(255,220,120,.80), rgba(255,150,60,.42) 55%, rgba(255,120,40,0) 72%),
      conic-gradient(from 0deg, rgba(255,200,120,.5), rgba(255,120,40,.2), rgba(255,200,120,.5));
    filter:blur(10px); border-radius:50% 50% 70% 70% / 60% 60% 100% 100%;
    opacity:0; animation: flame var(--descent) ease-out forwards;
  }

  .shadow{position:fixed; left:50%; top:76%; transform:translate(-50%,-50%);
          width:42vmin; height:42vmin; z-index:7; opacity:0;
          background:radial-gradient(circle, rgba(0,0,0,.5), rgba(0,0,0,0) 70%);
          filter:blur(10px); animation: shIn var(--descent) ease-out forwards;}
  .ring{position:fixed; left:50%; top:76%; transform:translate(-50%,-50%);
        width:2vmin; height:2vmin; border-radius:50%; z-index:8; opacity:0;
        box-shadow:0 0 0 0 rgba(210,140,90,0)}
  .field{position:fixed; inset:0; pointer-events:none; z-index:9}
  .dot{position:absolute; width:.9vmin; height:.9vmin; border-radius:50%;
       background:rgba(210,140,90,.95); filter:blur(.35px); opacity:0}
  .shake{animation:shake var(--shake) ease-in-out both}

  /* Animasyonlar */
  @keyframes descend{ from{transform:translate(-50%,-50%) translateY(-6vh) scale(1.9)}
                      70%{ transform:translate(-50%,-50%) translateY(14vh) scale(1.05)}
                      to { transform:translate(-50%,-50%) translateY(24vh) scale(.85)} }
  @keyframes tilt{ 0%{transform:translate(-50%,-50%) translateY(-6vh)  scale(1.9)  rotate(8deg)}
                   35%{transform:translate(-50%,-50%) translateY(4vh)   scale(1.35) rotate(-6deg)}
                   70%{transform:translate(-50%,-50%) translateY(14vh)  scale(1.05) rotate(3deg)}
                   100%{transform:translate(-50%,-50%) translateY(24vh) scale(.85)  rotate(0deg)} }
  @keyframes idle{ from{ transform:translate(-50%,-50%) translateY(24vh) scale(.845) }
                   to  { transform:translate(-50%,-50%) translateY(25.2vh) scale(.855) } }
  @keyframes flame{0%{opacity:0;transform:translate(-50%,-50%) scale(.4)}
                   40%{opacity:.9;transform:translate(-50%,-50%) scale(1)}
                   100%{opacity:.2;transform:translate(-50%,-50%) scale(.85)}}
  @keyframes shIn{ 0%{opacity:0; transform:translate(-50%,-50%) scale(.3)} 100%{opacity:.85; transform:translate(-50%,-50%) scale(1)} }
  @keyframes ringFx{0%{opacity:0;box-shadow:0 0 0 0 rgba(210,140,90,0)}
                    12%{opacity:.35}
                    100%{opacity:0;box-shadow:0 0 40vmin 12vmin rgba(210,140,90,.26)}}
  @keyframes shake{20%{transform:translate(2px,-2px)}40%{transform:translate(-3px,2px)}60%{transform:translate(3px,1px)}80%{transform:translate(-2px,-1px)}}
</style>
</head>
<body>
<canvas id="bg"></canvas>
<div class="vignette"></div>

<div class="safe">
  <div class="brand">Babypeacock — Top-Down Mars İnişi</div>
  <button class="btn" id="replay">Tekrar Oynat</button>
</div>

<div class="shadow"></div>
<div class="ring" id="ring"></div>
<div class="field" id="field"></div>

<div class="lander" id="lander">
  <img class="ship" src="Drone.png" alt="">
  <div class="flame"></div>
</div>

<script>
/* ===== Procedural top-down Mars + pad ===== */
const cvs = document.getElementById('bg');
const ctx = cvs.getContext('2d', { alpha:false });
let W=0,H=0, stones=[];

function R(a,b){ return a + Math.random()*(b-a) }

function resize(){
  W = cvs.width = innerWidth;
  H = cvs.height = innerHeight;

  stones = [];
  for(let i=0;i<360;i++){
    stones.push({
      x: Math.random()*W,
      y: Math.random()*H,
      r: 0.9 + Math.random()*2.6,
      rot: Math.random()*Math.PI*2,
      verts: 5 + Math.floor(Math.random()*6),
      rough: 0.65 + Math.random()*0.55
    });
  }
  draw(0);
}
addEventListener('resize', resize, {passive:true}); resize();

function draw(t){
  const g = ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0,'#6f3624'); g.addColorStop(1,'#8b472c');
  ctx.fillStyle=g; ctx.fillRect(0,0,W,H);

  for(let i=0;i<120;i++){
    const x=Math.random()*W, y=Math.random()*H, r=30+Math.random()*110;
    const d=ctx.createRadialGradient(x,y,0,x,y,r);
    d.addColorStop(0,`rgba(90,45,28,${0.05+Math.random()*0.07})`);
    d.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle=d; ctx.beginPath(); ctx.arc(x,y,r,0,2*Math.PI); ctx.fill();
  }

  // BPC iniş pisti
  const px=W/2, py=H*0.76, pr=Math.min(W,H)*0.11;
  const padG=ctx.createRadialGradient(px,py,pr*0.6,px,py,pr*1.25);
  padG.addColorStop(0,'rgba(0,0,0,.28)'); padG.addColorStop(1,'rgba(0,0,0,0)');
  ctx.fillStyle=padG; ctx.beginPath(); ctx.arc(px,py,pr*1.25,0,2*Math.PI); ctx.fill();
  ctx.fillStyle='rgba(235,210,150,0.08)'; ctx.strokeStyle='rgba(235,210,150,0.45)'; ctx.lineWidth=3;
  ctx.beginPath(); ctx.arc(px,py,pr,0,2*Math.PI); ctx.fill(); ctx.stroke();
  ctx.strokeStyle='rgba(235,210,150,0.35)'; ctx.lineWidth=2;
  ctx.beginPath(); ctx.arc(px,py,pr*0.68,0,2*Math.PI); ctx.stroke();
  ctx.fillStyle='rgba(255,240,210,0.9)'; ctx.font=`${Math.round(pr*0.42)}px system-ui,Segoe UI,Arial`;
  ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText('BPC',px,py);

  // düzensiz taşlar
  for(const s of stones){
    const sc = 1 + t*2.0, Rr = s.r*sc;
    ctx.save(); ctx.translate(s.x,s.y); ctx.rotate(s.rot);
    ctx.shadowColor='rgba(0,0,0,0.35)'; ctx.shadowBlur=6; ctx.shadowOffsetX=1.5; ctx.shadowOffsetY=1.6;
    ctx.beginPath();
    for(let i=0;i<s.verts;i++){
      const ang=(i/s.verts)*Math.PI*2, rr=Rr*(0.8+Math.random()*0.4)*s.rough;
      const px2=Math.cos(ang)*rr, py2=Math.sin(ang)*rr*0.9;
      (i===0)?ctx.moveTo(px2,py2):ctx.lineTo(px2,py2);
    }
    ctx.closePath(); ctx.fillStyle='rgba(55,32,25,0.95)'; ctx.fill();
    ctx.shadowColor='transparent'; ctx.fillStyle='rgba(210,150,100,0.25)';
    ctx.beginPath(); ctx.ellipse(-Rr*0.25,-Rr*0.25,Rr*0.45,Rr*0.28,-0.3,0,Math.PI*2); ctx.fill();
    ctx.restore();
  }

  const vg=ctx.createRadialGradient(W/2,H/2,Math.min(W,H)*.35,W/2,H/2,Math.max(W,H)*.95);
  vg.addColorStop(0,'rgba(0,0,0,0)'); vg.addColorStop(1,'rgba(0,0,0,.22)');
  ctx.fillStyle=vg; ctx.fillRect(0,0,W,H);
}

/* ===== ZAMANLAMA / EFEKTLER ===== */
const lander=document.getElementById('lander');
const ring=document.getElementById('ring');
const field=document.getElementById('field');
let t=0, playing=true;

function loop(){ if(playing){ t+=1/60/6.7; if(t>1) t=1; } draw(t); requestAnimationFrame(loop); }
loop();

/* toz (az) */
function particles(n=45){
  field.innerHTML='';
  const cx=innerWidth/2, cy=innerHeight*0.76;
  for(let i=0;i<n;i++){
    const d=document.createElement('div'); d.className='dot';
    d.style.left=(cx+(Math.random()*18-9))+'px';
    d.style.top =(cy+(Math.random()*12-6))+'px';
    field.appendChild(d);
    const ang=Math.random()*Math.PI*2, dist=6+Math.random()*14, up=-1+Math.random()*2, dur=480+Math.random()*700;
    d.animate([
      {transform:'translate(0,0)',opacity:0},
      {transform:`translate(${Math.cos(ang)*dist}vmin, ${Math.sin(ang)*dist+up}vmin)`,opacity:.9,offset:.28},
      {opacity:0}
    ],{duration:dur,easing:'ease-out',fill:'forwards',delay:Math.random()*120});
  }
}

/* ===== Sesler ===== */
let sweepCtx, sweepOsc, sweepNoise, sweepGain; // tarama sesi için referanslar

// İniş boyunca süren radyo frekans taraması (daha tok, parazitli)
function startRadioSweep(){
  const AC=window.AudioContext||window.webkitAudioContext;
  if(!AC) return;
  sweepCtx=new AC();
  const now=sweepCtx.currentTime;

  // taşıyıcı ve frekans süpürme
  sweepOsc=sweepCtx.createOscillator();
  sweepOsc.type='sine';
  sweepOsc.frequency.setValueAtTime(420,now);
  sweepOsc.frequency.linearRampToValueAtTime(1200, now + 1.6);
  sweepOsc.frequency.linearRampToValueAtTime(500,  now + 3.2);
  sweepOsc.frequency.linearRampToValueAtTime(800,  now + 5.0);

  // parazit
  const buf=sweepCtx.createBuffer(1, sweepCtx.sampleRate*2, sweepCtx.sampleRate);
  const data=buf.getChannelData(0);
  for(let i=0;i<data.length;i++){ data[i]=(Math.random()*2-1)*0.6; }
  sweepNoise=sweepCtx.createBufferSource(); sweepNoise.buffer=buf; sweepNoise.loop=true;

  // filtre ve seviye
  const lp=sweepCtx.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value=900;
  sweepGain=sweepCtx.createGain(); sweepGain.gain.setValueAtTime(0.0,now);
  sweepGain.gain.linearRampToValueAtTime(0.18, now+0.08); // yumuşak açılış

  sweepNoise.connect(lp).connect(sweepGain).connect(sweepCtx.destination);
  sweepOsc.connect(lp).connect(sweepGain);

  sweepNoise.start(now+0.02);
  sweepOsc.start(now);
}
function stopRadioSweep(){
  if(!sweepCtx) return;
  const now=sweepCtx.currentTime;
  sweepGain.gain.cancelScheduledValues(now);
  sweepGain.gain.exponentialRampToValueAtTime(0.0001, now+0.12);
  try{ sweepOsc.stop(now+0.14); sweepNoise.stop(now+0.14);}catch(e){}
  setTimeout(()=>{ try{sweepCtx.close();}catch(e){}; sweepCtx=null; },180);
}

// İniş anında kısa telsiz “carrier + statik” patlaması
function radioComms(){
  const AC=window.AudioContext||window.webkitAudioContext;
  if(!AC) return;
  const ac=new AC(); const now=ac.currentTime;

  const osc=ac.createOscillator(); osc.type='sine'; osc.frequency.setValueAtTime(520,now);
  const lp=ac.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value=800;
  const buf=ac.createBuffer(1, ac.sampleRate*1, ac.sampleRate);
  const data=buf.getChannelData(0); for(let i=0;i<data.length;i++){ data[i]=(Math.random()*2-1)*(1-i/data.length); }
  const noise=ac.createBufferSource(); noise.buffer=buf;

  const g=ac.createGain(); g.gain.setValueAtTime(0,now);
  g.gain.linearRampToValueAtTime(0.22,now+0.03);
  g.gain.exponentialRampToValueAtTime(0.02,now+0.9);

  noise.connect(lp).connect(g).connect(ac.destination);
  osc.connect(lp).connect(g);
  osc.start(now); noise.start(now+0.01);
  osc.stop(now+0.95); noise.stop(now+1.0);
}

/* tetikleme */
const T=6700;
startRadioSweep(); // iniş başlarken tarama sesi
setTimeout(()=>{ stopRadioSweep(); ring.style.animation='ringFx var(--dust) ease-out 0s 1 forwards'; particles(); shake(); radioComms(); }, T-140);

/* sarsıntı */
function shake(){ document.body.classList.add('shake'); setTimeout(()=>document.body.classList.remove('shake'),700); }

/* replay */
const replayBtn=document.getElementById('replay');
replayBtn.onclick=restart;
document.body.addEventListener('click',(e)=>{ if(e.target===replayBtn||e.target.closest('.safe')) return; restart(); });
function restart(){
  lander.style.animation='none'; ring.style.animation='none';
  t=0; playing=true; field.innerHTML='';
  requestAnimationFrame(()=>{ lander.style.animation=''; });

  stopRadioSweep(); startRadioSweep(); // sesi başa sar
  setTimeout(()=>{ stopRadioSweep(); ring.style.animation='ringFx var(--dust) ease-out 0s 1 forwards'; particles(); shake(); radioComms(); }, T-140);
}

/* preload */
(new Image()).src='Drone.png';
</script>
</body>
</html>
