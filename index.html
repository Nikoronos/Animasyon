<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BPC Intro â€¢ ÅžimÅŸekli KuÅŸ</title>
<style>
  :root{--bg:#000;--fg:#eaeaea}
  *{box-sizing:border-box}
  body{margin:0;background:#000;color:var(--fg);font-family:system-ui,Segoe UI,Arial,sans-serif;display:grid;grid-template-rows:auto 1fr auto;min-height:100svh}
  header,footer{padding:12px 16px;opacity:.9}
  .panel{display:flex;gap:10px;flex-wrap:wrap;align-items:center;padding:0 16px 10px}
  input,button{background:#101010;color:var(--fg);border:1px solid #2a2a2a;border-radius:10px;padding:9px 12px}
  button{cursor:pointer} button:hover{border-color:#5a5a5a}
  #cv{width:100%;max-width:1080px;aspect-ratio:16/9;display:block;margin:0 auto;border-radius:14px;background:#000}
  .pill{border-radius:999px;padding:6px 10px;border:1px solid #2a2a2a;font-size:12px}
  #dl{display:none}
</style>
</head>
<body>
<header><b>ðŸ¦š BPC Intro â€¢ ÅžimÅŸekli KuÅŸ</b></header>

<div class="panel">
  <label>SÃ¼re(sn) <input id="dur" type="number" value="6" min="5" max="10"></label>
  <label>Ã‡Ã¶zÃ¼nÃ¼rlÃ¼k <input id="res" type="number" value="1920"></label>
  <button id="preview">Ã–nizleme</button>
  <button id="record">KaydÄ± Al (MP4)</button>
  <a id="dl" class="pill" download="bpc-intro.mp4">Ä°ndir</a>
  <span id="status" class="pill">AkÄ±ÅŸ: Siyah â†’ ÅžimÅŸek â†’ KuÅŸ â†’ AydÄ±nlanma</span>
</div>

<canvas id="cv" width="1920" height="1080"></canvas>

<footer>Ä°lk MP4â€™te bekleme normaldir (tarayÄ±cÄ± desteÄŸine gÃ¶re MP4/WebM). Sonrakiler hÄ±zlÄ±dÄ±r.</footer>

<script>
(() => {
  const cv=document.getElementById('cv'), cx=cv.getContext('2d');
  const ui={
    dur:document.getElementById('dur'),
    res:document.getElementById('res'),
    preview:document.getElementById('preview'),
    record:document.getElementById('record'),
    dl:document.getElementById('dl'),
    status:document.getElementById('status'),
  };
  const FPS=60, AR=16/9;
  let raf=0, t0=0;

  function setSize(w){
    const W=Math.max(960,Math.min(3840,parseInt(w||1920,10)));
    cv.width=W; cv.height=Math.round(W/AR);
  }
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  const easeOutCubic=t=>1-Math.pow(1-t,3);
  const easeInCubic=t=>t*t*t;
  const easeInOutQuad=t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2;

  // KuÅŸ gÃ¶rseli (siyah arka planÄ± transparan yap)
  const raw=new Image(); raw.crossOrigin='anonymous'; raw.src='bpc-bird.png';
  let logo=null; raw.onload=()=>{ const off=document.createElement('canvas'), o=off.getContext('2d');
    off.width=raw.naturalWidth; off.height=raw.naturalHeight; o.drawImage(raw,0,0);
    const img=o.getImageData(0,0,off.width,off.height), d=img.data;
    for(let i=0;i<d.length;i+=4){ const r=d[i],g=d[i+1],b=d[i+2]; if(r<22&&g<22&&b<22) d[i+3]=0; }
    o.putImageData(img,0,0); logo=off;
  };

  // ÅžimÅŸek oluÅŸturucu
  function drawBolt(x0,y0,x1,y1,branches=2,thick=6,alpha=1){
    cx.save();
    cx.globalCompositeOperation='screen';
    cx.strokeStyle='rgba(180,230,255,'+alpha+')';
    cx.shadowColor='rgba(120,200,255,'+alpha+')';
    cx.shadowBlur=24;
    cx.lineCap='round';
    let pts=[[x0,y0]], x=x0, y=y0;
    const seg=12;
    for(let i=0;i<seg;i++){
      const t=i/seg;
      const nx = x + (x1-x0)/seg + (Math.random()-0.5)*40*(1-t);
      const ny = y + (y1-y0)/seg + (Math.random()-0.5)*20*(1-t);
      x=nx; y=ny; pts.push([x,y]);
    }
    cx.lineWidth=thick;
    cx.beginPath(); cx.moveTo(pts[0][0],pts[0][1]);
    for(const p of pts) cx.lineTo(p[0],p[1]);
    cx.stroke();

    // dallar
    for(let b=0;b<branches;b++){
      const i = 2 + Math.floor(Math.random()*(pts.length-4));
      const [bx,by]=pts[i];
      const ang = Math.atan2(y1-y0, x1-x0) + (Math.random()<.5?-1:1)*(Math.random()*0.7+0.3);
      const len = 120 + Math.random()*160;
      cx.lineWidth=Math.max(2, thick*0.5);
      cx.beginPath();
      cx.moveTo(bx,by);
      cx.lineTo(bx+Math.cos(ang)*len, by+Math.sin(ang)*len);
      cx.stroke();
    }
    cx.restore();
  }

  // ana sahne
  function draw(ts){
    const W=cv.width,H=cv.height; const now=((ts-t0)/1000)||0;
    const D = clamp(+ui.dur.value||6,5,10);

    // AÅŸamalar (saniyeler)
    const tBlackEnd   = 1.0;      // 0â€“1: tam siyah
    const tLightning  = [1.0, 2.2]; // 1â€“2.2: ÅŸimÅŸekler
    const tBirdIn     = [2.2, 3.2]; // 2.2â€“3.2: kuÅŸ ortaya Ã§Ä±kÄ±yor
    const tBrighten   = [3.2, 5.5]; // 3.2â€“5.5: ortam aydÄ±nlanÄ±yor
    const tFadeOutS   = Math.min(D-0.5,5.7); // son yarÄ±m saniye fade-out

    // varsayÄ±lan siyah arka plan
    cx.fillStyle='#000'; cx.fillRect(0,0,W,H);

    // ÅžimÅŸek Ã¶ncesi hafif ortam parlamasÄ± (aÅŸamalÄ±)
    let ambient = 0;
    if(now>tBrighten[0]){
      const k = clamp((now - tBrighten[0]) / (tBrighten[1]-tBrighten[0]), 0, 1);
      ambient = easeInOutQuad(k) * 0.5; // 0 â†’ 0.5
    }
    // Vinyet/aydÄ±nlÄ±k
    const vign=cx.createRadialGradient(W/2,H/2,0,W/2,H/2,W*0.9);
    vign.addColorStop(0, `rgba(255,255,255,${0.08+ambient*0.35})`);
    vign.addColorStop(1, 'rgba(0,0,0,0)');
    cx.fillStyle=vign; cx.fillRect(0,0,W,H);

    // ÅžimÅŸekler (1â€“2.2s)
    if(now>=tLightning[0] && now<=tLightning[1]){
      const phase = (now - tLightning[0]) / (tLightning[1]-tLightning[0]); // 0..1
      // ekran sarsÄ±ntÄ±sÄ±
      const shake = (1 - phase)*8;
      cx.save();
      cx.translate((Math.random()-0.5)*shake, (Math.random()-0.5)*shake);

      // 2â€“4 bolt/frame
      const bolts = 2 + Math.floor(Math.random()*3);
      for(let i=0;i<bolts;i++){
        const sx = Math.random()*W;       // gÃ¶k gÃ¼rÃ¼ltÃ¼sÃ¼ gibi farklÄ± yerler
        const sy = -50;                   // yukarÄ±dan
        const ex = W*0.35 + Math.random()*W*0.3; // merkeze yakÄ±n
        const ey = H*0.45 + Math.random()*H*0.2;
        drawBolt(sx,sy,ex,ey, 1+Math.floor(Math.random()*2), 5+Math.random()*4, 0.9);
      }

      // beyaz flash (fotoÄŸraf patlamasÄ± gibi)
      cx.fillStyle = `rgba(255,255,255,${0.25*(1-phase)})`;
      cx.fillRect(0,0,W,H);
      cx.restore();
    }

    // KuÅŸ (2.2â€“3.2 arasÄ± ortaya Ã§Ä±kÄ±yor, sonra kalÄ±yor)
    if(logo){
      let alpha=0;
      if(now>=tBirdIn[0] && now<=tBirdIn[1]){
        const k = (now - tBirdIn[0]) / (tBirdIn[1]-tBirdIn[0]); // 0..1
        alpha = easeOutCubic(k);
      } else if(now>tBirdIn[1]){
        alpha = 1;
      }
      // Fade out son anda (opsiyonel)
      if(now>=tFadeOutS) alpha *= (1 - clamp((now - tFadeOutS)/0.5, 0, 1));

      const base = H*0.5;
      const pulse = 1 + Math.sin(now*1.6)*0.03*(now>tBirdIn[0]?1:0);
      cx.save();
      cx.globalAlpha = alpha;
      cx.translate(W/2, H*0.55);
      // kuÅŸa hafif Ä±ÅŸÄ±k
      cx.shadowColor='rgba(200,240,255,.35)'; cx.shadowBlur=W*0.02;
      cx.scale(pulse,pulse);
      cx.drawImage(logo, -base/2, -base/2, base, base);
      cx.restore();
    }

    // AydÄ±nlanma evresinde minimal halka parÄ±ltÄ±sÄ±
    if(now>=tBrighten[0]){
      const k = clamp((now - tBrighten[0]) / (tBrighten[1]-tBrighten[0]), 0, 1);
      const glow = easeInOutQuad(k);
      cx.save();
      cx.translate(cv.width/2, cv.height/2);
      cx.globalAlpha = glow * 0.6;
      cx.lineWidth = cv.width*0.015;
      const ring = cx.createConicGradient(now*0.15, 0, 0);
      ring.addColorStop(0,'#00ffd5'); ring.addColorStop(1,'#7f00ff');
      cx.strokeStyle = ring;
      cx.shadowColor='rgba(0,255,213,.35)'; cx.shadowBlur=cv.width*0.02;
      cx.beginPath(); cx.arc(0,0,cv.height*0.27,0,Math.PI*2); cx.stroke();
      cx.restore();
    }

    // BitiÅŸ veya devam
    const D = clamp(+ui.dur.value||6,5,10);
    if(now < D){ raf=requestAnimationFrame(draw); }
  }

  function startPreview(){
    cancelAnimationFrame(raf); setSize(ui.res.value); t0=performance.now(); raf=requestAnimationFrame(draw);
    ui.status.textContent='Ã–nizleme oynuyor';
  }

  async function record(){
    cancelAnimationFrame(raf); setSize(ui.res.value);
    const secs = clamp(+ui.dur.value||6,5,10);
    const stream=cv.captureStream(FPS);
    let chunks=[];
    const mp4Try='video/mp4;codecs=avc1.4d0028';
    const mime = (MediaRecorder.isTypeSupported?.(mp4Try))?mp4Try:'video/webm;codecs=vp9';
    const rec=new MediaRecorder(stream,{mimeType:mime,videoBitsPerSecond:10_000_000});
    rec.ondataavailable=e=>{ if(e.data&&e.data.size) chunks.push(e.data); };
    rec.onstop=()=>{ const blob=new Blob(chunks,{type:mime}); const url=URL.createObjectURL(blob);
      ui.dl.href=url; ui.dl.download = mime.startsWith('video/mp4')?'bpc-intro.mp4':'bpc-intro.webm';
      ui.dl.style.display='inline-block'; ui.dl.textContent='Ä°ndir: '+ui.dl.download; ui.status.textContent='KayÄ±t tamamlandÄ±.'; };
    // zamanlÄ± oynat + kayÄ±t
    t0=performance.now(); raf=requestAnimationFrame(draw); rec.start();
    ui.status.textContent='Kaydediliyor...';
    setTimeout(()=>{ if(rec.state!=='inactive') rec.stop(); cancelAnimationFrame(raf); }, secs*1000+120);
  }

  ui.preview.onclick=startPreview;
  ui.record.onclick=record;
})();
</script>
</body>
</html>
